# Nodeå…¥é—¨

## ç®€ä»‹å’ŒèƒŒæ™¯

```
Node.jsÂ® is a JavaScript runtime built on Chrome's V8 JavaScript engine.
```
ä¸€ä¸ªåŸºäºchrome v8 çš„javascriptå¼•æ“æ„å»ºçš„javascriptè¿è¡Œæ—¶ã€‚

Atwoodå®šå¾‹ï¼š
> ä»»ä½•èƒ½å¤Ÿç”¨`JavaScript`å®ç°çš„åº”ç”¨ç³»ç»Ÿï¼Œæœ€ç»ˆéƒ½å¿…å°†ç”¨`JavaScript`å®ç°(Jeff Atwood)

PS:å­¦ä¹ nodeçº¯å±ä¸ªäººå…´è¶£ï¼Œä¸æ¶‰åŠåˆ°å‰ç«¯å’Œåç«¯ä¹‹é—´çš„äº‰å¤ºå’Œåˆ©ç›Šå†²çªï¼ˆå“ˆå“ˆå“ˆğŸ˜ï¼‰ã€‚

## åŸç†
![2018070502.png](./../assets/images/2018070502.png)

Node.js æ˜¯åŸºäº Chrome V8å¼•æ“æ„å»ºçš„ï¼Œç”±äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰åˆ†å‘ I/O ä»»åŠ¡ï¼Œæœ€ç»ˆå·¥ä½œçº¿ç¨‹ï¼ˆWork Threadï¼‰å°†ä»»åŠ¡ä¸¢åˆ°çº¿ç¨‹æ± ï¼ˆThread Poolï¼‰é‡Œå»æ‰§è¡Œï¼Œè€Œäº‹ä»¶å¾ªç¯åªè¦ç­‰å¾…æ‰§è¡Œç»“æœå°±å¯ä»¥äº†ã€‚

æ¢³ç†ï¼š
* Chrome V8 æ˜¯ JavaScript å¼•æ“
* Node.js å†…ç½® Chrome V8 å¼•æ“ï¼Œæ‰€ä»¥å®ƒä½¿ç”¨çš„ JavaScript è¯­æ³•
* JavaScript è¯­è¨€çš„ä¸€å¤§ç‰¹ç‚¹å°±æ˜¯å•çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒä¸€ä¸ªæ—¶é—´åªèƒ½åšä¸€ä»¶äº‹
* å•çº¿ç¨‹å°±æ„å‘³ç€ï¼Œæ‰€æœ‰ä»»åŠ¡éœ€è¦æ’é˜Ÿï¼Œå‰ä¸€ä¸ªä»»åŠ¡ç»“æŸï¼Œæ‰ä¼šæ‰§è¡Œåä¸€ä¸ªä»»åŠ¡ã€‚å¦‚æœå‰ä¸€ä¸ªä»»åŠ¡è€—æ—¶å¾ˆé•¿ï¼Œåä¸€ä¸ªä»»åŠ¡å°±ä¸å¾—ä¸ä¸€ç›´ç­‰ç€
* å¦‚æœæ’é˜Ÿæ˜¯å› ä¸ºè®¡ç®—é‡å¤§ï¼ŒCPU å¿™ä¸è¿‡æ¥ï¼Œå€’ä¹Ÿç®—äº†ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™ CPU æ˜¯é—²ç€çš„ï¼Œå› ä¸º I/O å¾ˆæ…¢ï¼Œä¸å¾—ä¸ç­‰ç€ç»“æœå‡ºæ¥ï¼Œå†å¾€ä¸‹æ‰§è¡Œ
* CPU å®Œå…¨å¯ä»¥ä¸ç®¡ I/O è®¾å¤‡ï¼ŒæŒ‚èµ·å¤„äºç­‰å¾…ä¸­çš„ä»»åŠ¡ï¼Œå…ˆè¿è¡Œæ’åœ¨åé¢çš„ä»»åŠ¡
* å°†ç­‰å¾…ä¸­çš„ I/O ä»»åŠ¡æ”¾åˆ° Event Loop é‡Œ
* ç”± Event Loop å°† I/O ä»»åŠ¡æ”¾åˆ°çº¿ç¨‹æ± é‡Œ
* åªè¦æœ‰èµ„æºï¼Œå°±å°½åŠ›æ‰§è¡Œ

> ï¼ˆæ‘˜è‡ªå‚è€ƒ5ï¼‰

## ä½¿ç”¨åœºæ™¯

![2018070501.png](./../assets/images/2018070501.png)

|åˆ†ç±»|æè¿°|ç›¸å…³æ¨¡å—|
|:---:|:---:|:---:|
|ç½‘ç«™|ç±»ä¼¼äº cnodejs.org è¿™æ ·ä¼ ç»Ÿçš„ç½‘ç«™|Express / Koa|
|Api|åŒæ—¶æä¾›ç»™ç§»åŠ¨ç«¯ï¼ŒPCï¼ŒH5 ç­‰å‰ç«¯ä½¿ç”¨çš„ HTTP Api æ¥å£|Restify / HApi|
|Apiä»£ç†|ä¸ºå‰ç«¯æä¾›çš„ï¼Œä¸»è¦å¯¹åç«¯Apiæ¥å£è¿›è¡Œå†å¤„ç†ï¼Œä»¥ä¾¿æ›´å¤šçš„é€‚åº”å‰ç«¯å¼€å‘|Express / Koa|
|IMå³æ—¶èŠå¤©|å®æ—¶åº”ç”¨ï¼Œå¾ˆå¤šæ˜¯åŸºäº WebSocketåè®®çš„|Socket.io / sockjs|
|åå‘ä»£ç†|æä¾›ç±»ä¼¼äº nginx åå‘ä»£ç†åŠŸèƒ½ï¼Œä½†å¯¹å‰ç«¯æ›´å‹å¥½|anyproxy / node-http-proxy / hiproxy|
|å‰ç«¯æ„å»ºå·¥å…·|è¾…åŠ©å‰ç«¯å¼€å‘ï¼Œå°¤å…¶æ˜¯å„ç§é¢„ç¼–è¯‘ï¼Œæ„å»ºç›¸å…³çš„å·¥å…·ï¼Œèƒ½å¤Ÿæå¤§çš„æé«˜å‰ç«¯å¼€å‘æ•ˆç‡|Grunt / Gulp / Bower / Webpack / Fis3 / YKit|
|å‘½ä»¤è¡Œå·¥å…·|ä½¿ç”¨å‘½ä»¤è¡Œæ˜¯éå¸¸é…·çš„æ–¹å¼ï¼Œå‰ç«¯å¼€å‘è‡ªå®šä¹‰äº†å¾ˆå¤šç›¸å…³å·¥å…·ï¼Œæ— è®ºæ˜¯shellå‘½ä»¤ï¼Œnodeè„šæœ¬ï¼Œè¿˜æ˜¯å„ç§è„šæ‰‹æ¶ç­‰ï¼Œå‡ ä¹æ¯ä¸ªå…¬å¸\å°ç»„éƒ½ä¼šè‡ªå·±çš„å‘½ä»¤è¡Œå·¥å…·é›†|Cordova / Shell.js|
|æ“ä½œç³»ç»Ÿ|æœ‰å®ç°ï¼Œä½†ä¼°è®¡ä¸å¤ªä¼šæœ‰äººç”¨|NodeOS|
|è·¨å¹³å°æ‰“åŒ…å·¥å…·|ä½¿ç”¨ Web å¼€å‘æŠ€æœ¯å¼€å‘PCå®¢æˆ·ç«¯æ˜¯ç›®å‰æœ€æµè¡Œçš„æ–¹å¼ï¼Œä¼šæœ‰æ›´å¤šå‰ç«¯å¼€å‘å·¥å…·æ˜¯é‡‡ç”¨è¿™ç§æ–¹å¼çš„|PCç«¯çš„electronã€nw.jsï¼Œæ¯”å¦‚é’‰é’‰PCå®¢æˆ·ç«¯ã€å¾®ä¿¡å°ç¨‹åºIDEã€å¾®ä¿¡å®¢æˆ·ç«¯ï¼Œç§»åŠ¨çš„Cordovaï¼Œå³è€çš„Phonegapï¼Œè¿˜æœ‰æ›´åŠ æœ‰åçš„ä¸€ç«™å¼å¼€å‘æ¡†æ¶Ionicframework|
|P2P|åŒºå—é“¾å¼€å‘ã€BTå®¢æˆ·ç«¯|webtorrent / ipfs|
|ç¼–è¾‘å™¨|Atom å’Œ VSCode éƒ½æ˜¯åŸºäº electron æ¨¡å—çš„|electron|
|ç‰©è”ç½‘ä¸ç¡¬ä»¶|ruff.ioå’Œå¾ˆå¤šç¡¬ä»¶éƒ½æ”¯æŒnode sdk|ruff|

> ï¼ˆæ‘˜è‡ªå‚è€ƒ5ï¼‰

## å¼‚æ­¥æµç¨‹æŠ€æœ¯æ¼”å˜
å»ºè®®é˜…è¯»å‚è€ƒ1ï¼Œå…³äºnodeçš„å¼‚æ­¥æµç¨‹æ¼”å˜è¿‡ç¨‹ã€‚(ç‹¼å”å¨æ­¦ï¼)

### Promiseå¤§æ³•
å®ç°çš„ä»£ç å‚è€ƒé“¾æ¥2ï¼Œé‡‡ç”¨äº†expressæ¡†æ¶ï¼Œä»£ç ç»“æ„è¯¸å¦‚ä»¥ä¸‹ï¼š
```
updateById(id, params, callback) {
    this.findById(id, goods => {
        if (goods) {
            Promise.resolve(
                this.repository.updateById(id, params)
            ).then(result => {
                callback(result)
            }).catch(err => {
                callback(false)
            })
        } else {
            callback(false)
        }
    })
}
```
æ€»ä½“çš„æ„Ÿå—å°±æ˜¯å¦‚æœä½ çš„é¡¹ç›®åˆ†å±‚äº†çš„è¯ï¼Œæ¯”å¦‚åˆ†æˆäº†controller,module,service,repository,modelå±‚ï¼Œcallbackå¤§æ³•å°±éœ€è¦ä¸€è·¯ä¼ å…¥åˆ°åº•ï¼Œè¿™ç§åšæ³•æœ‰ç‚¹åƒä½ è®©ä¸€ä¸ªäººå¸®ä½ ä¹°ä¸€ä¸ªè›‹ç³•ï¼Œç„¶åç»™ä»–ä¸€ä¸ªç›˜å­ï¼ˆå› ä¸ºä½ æƒ³ç”¨ç›˜å­æ¥ç››ï¼‰ï¼Œç„¶åä»–ä¹°çš„æ—¶å€™å†æŠŠç›˜å­ç»™å”®è´§å‘˜ã€‚ã€‚ã€‚

### Async/Awaitå¤§æ³•
å®ç°çš„ä»£ç å‚è€ƒé“¾æ¥3ï¼Œé‡‡ç”¨äº†å›½äº§thinkjsæ¡†æ¶ï¼Œä»£ç ç»“æ„è¯¸å¦‚ä»¥ä¸‹ï¼š
```
  async create(params) {
    let goods = await this.model('goods/goods').findByName(params.name);
    // æœ‰å±æ€§ï¼Œä¸ä¸ºç©º
    if (think.app.context.isEmpty(goods)) {
      think.logger.info('[create]search info if exsit: ', [JSON.stringify(goods)]);
      return false;
    }
    let res = await this.model('goods/goods').create(params);
    return res;
  }
```
æ€»ä½“çš„æ„Ÿå—å°±æ˜¯æ‘†è„±äº†Promiseçš„callbackï¼Œä»£ç çœ‹ä¸Šå»åƒåŒæ­¥ï¼ˆå®è´¨æ˜¯å¼‚æ­¥ï¼‰ï¼Œè¶Šæ¥è¶Šå¯¹åç«¯å¼€å‘è€…å‹å–„äº†~~~

## å¤‡æ³¨
### ä½¿ç”¨å»ºè®®
å‚ç…§5ï¼Œç‹¼å”ç»™å‡ºäº†å¼‚æ­¥æµç¨‹æ§åˆ¶çš„å»ºè®®ï¼Œæ€»ä½“æ¥è¯´Promiseæ˜¯åŸºç¡€çš„ï¼Œä¹Ÿæ˜¯ä½¿ç”¨æœ€å¤šçš„ï¼Œæ˜¯åŸºç¡€ï¼ŒAsyncæ˜¯è¶‹åŠ¿ã€‚

### è°ƒè¯•
è°ƒè¯•å¯ä¸ºæ‰“æ—¥å¿—è¾“å…¥æ§åˆ¶å°ï¼Œç»“åˆIDEè¿›è¡Œæ–­ç‚¹è°ƒè¯•ï¼Œç¼–å†™æµ‹è¯•ç”¨ä¾‹ç­‰æ–¹å¼ã€‚
ç»™å‡ºthinkjsè°ƒè¯•æ–¹æ³•ï¼šhttps://thinkjs.org/zh-cn/doc/3.0/debug.htmlï¼Œå¾ˆæ–¹ä¾¿ï¼ŒPromiseæˆ‘ä½¿ç”¨çš„æ˜¯console.logè¿›è¡Œè°ƒè¯•çš„ï¼Œä¸€èˆ¬æ‰“æ—¥å¿—å°±è¶³å¤Ÿäº†ã€‚

## å‚è€ƒ
1. [https://cnodejs.org/topic/560dbc826a1ed28204a1e7de](https://cnodejs.org/topic/560dbc826a1ed28204a1e7de)
2. [https://github.com/Birjemin/express-babel](https://github.com/Birjemin/express-babel)
3. [https://github.com/Birjemin/express-thinkjs](https://github.com/Birjemin/express-thinkjs)
4. [https://thinkjs.org/doc/index.html](https://thinkjs.org/doc/index.html)
5. [https://i5ting.github.io/How-to-learn-node-correctly/](https://i5ting.github.io/How-to-learn-node-correctly/)